#!/bin/sh

# Copy evcc service to /service/evcc to run on startup
cp -rf /data/evcc/service /service/evcc

# Create /data/evcc/evcc.json
exec /data/evcc/evcc-autoconfig.py > /data/evcc/evcc.json

# Make evcc survive a VenusOS update
touch /data/rc.local
chmod +x /data/rc.local
grep -qxF 'cp -rf /data/evcc/service /service/evcc' /data/rc.local || printf '# Auto-reinstall evcc\ncp -rf /data/evcc/service /service/evcc\n' >> /data/rc.local